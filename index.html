<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="style.css">
	<script type="text/javascript" src="core.js"></script>
	<script type="text/javascript" src="app.js"></script>
</head>
<body>
	<canvas id="c"></canvas>
	
	<div id="top">
	
		<span class="b" onclick="windows.warning.buttons[0].functions=resetFunctions[0];api.callPopup2(windows.warning)"><svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M88,28v56c0,6.627-5.373,12-12,12H20c-6.627,0-12-5.373-12-12V12C8,5.373,13.373,0,20,0h40L88,28z M60,28h16.687L60,11.313V28z M80,84V36H52V8H20c-1.441,0-2.391,0.734-2.829,1.171C16.734,9.609,16,10.559,16,12v72c0,1.441,0.734,2.391,1.171,2.828C17.609,87.266,18.559,88,20,88h56c1.441,0,2.391-0.734,2.828-1.172S80,85.441,80,84z"/></svg><b>Новый</b></span>
		<span class="b na"><svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M37.414,24.438L39.718,28H44h36c2.206,0,4,1.794,4,4v44c0,2.206-1.794,4-4,4H16c-2.206,0-4-1.794-4-4V20c0-2.206,1.794-4,4-4h16L37.414,24.438zM36,8H16C9.37,8,4,13.37,4,20v56c0,6.63,5.37,12,12,12h64c6.63,0,12-5.37,12-12V32c0-6.63-5.37-12-12-12H44L36,8L36,8z"/></svg><b>Открыть</b></span>
		<span class="b na"><svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M25.172,46.829c-1.562-1.562-1.562-4.095,0-5.657s4.095-1.562,5.657,0L44,54.344V8c0-2.208,1.792-4,4-4c2.209,0,4,1.792,4,4v46.343l13.172-13.171c1.562-1.562,4.095-1.562,5.656,0c1.562,1.562,1.562,4.095,0,5.657l-20,20c-0.781,0.78-1.805,1.172-2.828,1.172c-1.024,0-2.047-0.392-2.829-1.172L25.172,46.829z M88,60.001c-2.209,0-4,1.791-4,3.999v16.001C84,82.206,82.253,84,80.105,84H16c-2.205,0-4-1.794-4-3.999V64c0-2.208-1.791-3.999-3.999-3.999c-2.21,0-4,1.791-4,3.999v16.001c0,1.618,0.318,3.189,0.944,4.672c0.604,1.43,1.469,2.712,2.57,3.813c1.101,1.1,2.384,1.965,3.813,2.569C12.81,91.684,14.381,92,16,92h64.105c1.61,0,3.174-0.32,4.648-0.952c1.418-0.607,2.69-1.476,3.78-2.581c1.088-1.101,1.94-2.384,2.536-3.812c0.617-1.477,0.93-3.043,0.93-4.654V64C92,61.792,90.209,60.001,88,60.001z"/></svg><b>Импорт</b></span>
		<span class="b na"><svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M25.172,30.829c-1.562-1.562-1.562-4.095,0-5.657l20-20c1.562-1.562,4.095-1.562,5.656,0l20,20c1.562,1.562,1.562,4.095,0,5.657C70.047,31.61,69.023,32,68,32s-2.047-0.39-2.828-1.171L52,17.657V64c0,2.209-1.791,4-4,4s-4-1.791-4-4V17.657L30.828,30.829C29.267,32.39,26.733,32.39,25.172,30.829z M88,60c-2.209,0-4,1.791-4,4v16c0,2.205-1.747,4-3.895,4H16c-2.206,0-4-1.795-4-4V64c0-2.209-1.791-4-4-4s-4,1.791-4,4v16c0,1.619,0.317,3.189,0.944,4.672c0.604,1.43,1.47,2.713,2.57,3.812c1.101,1.102,2.384,1.967,3.813,2.57C12.81,91.682,14.382,92,16,92h64.105c1.61,0,3.175-0.32,4.648-0.951c1.418-0.609,2.69-1.477,3.781-2.582c1.087-1.102,1.939-2.385,2.536-3.812C91.688,83.178,92,81.611,92,80V64C92,61.791,90.209,60,88,60z"/></svg><b>Экспорт</b></span>
		<span class="b stillsel" id="settings_button" onclick="api.callWindow('settings')"><svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M84,60c6.627,0,12-5.373,12-12s-5.373-12-12-12h-2.049c-0.426-1.204-0.913-2.379-1.46-3.521l1.45-1.449c4.686-4.687,4.686-12.284,0-16.971c-4.687-4.686-12.284-4.686-16.971,0l-1.449,1.45c-1.143-0.547-2.317-1.034-3.521-1.46V12c0-6.627-5.373-12-12-12S36,5.373,36,12v2.049c-1.204,0.426-2.379,0.913-3.521,1.46l-1.449-1.45c-4.687-4.686-12.284-4.686-16.971,0c-4.686,4.687-4.686,12.284,0,16.971l1.45,1.449c-0.547,1.143-1.034,2.317-1.46,3.521H12C5.373,36,0,41.373,0,48s5.373,12,12,12h2.049c0.426,1.204,0.913,2.379,1.46,3.521l-1.45,1.449c-4.686,4.687-4.686,12.284,0,16.971c4.687,4.686,12.284,4.686,16.971,0l1.449-1.45c1.143,0.547,2.317,1.034,3.521,1.46V84c0,6.627,5.373,12,12,12s12-5.373,12-12v-2.049c1.204-0.426,2.379-0.913,3.521-1.46l1.449,1.45c4.687,4.686,12.284,4.686,16.971,0c4.686-4.687,4.686-12.284,0-16.971l-1.45-1.449c0.547-1.143,1.034-2.317,1.46-3.521H84z M75.717,52c-0.679,4.744-2.547,9.104-5.291,12.769l5.701,5.702l0.157,0.156c1.562,1.562,1.562,4.096,0,5.657s-4.095,1.562-5.657,0l-0.156-0.157l-5.702-5.701C61.104,73.17,56.744,75.038,52,75.717V84c0,2.209-1.791,4-4,4s-4-1.791-4-4v-8.283c-4.744-0.679-9.104-2.547-12.769-5.291l-5.702,5.701l-0.156,0.157c-1.562,1.562-4.096,1.562-5.657,0s-1.562-4.095,0-5.657l0.157-0.156l5.701-5.702C22.83,61.104,20.962,56.744,20.283,52H12c-2.209,0-4-1.791-4-4s1.791-4,4-4h8.283c0.679-4.744,2.547-9.104,5.291-12.769l-5.701-5.702l-0.157-0.156c-1.562-1.562-1.562-4.096,0-5.657s4.095-1.562,5.657,0l0.156,0.157l5.702,5.701c3.665-2.744,8.024-4.612,12.769-5.291V12c0-2.209,1.791-4,4-4s4,1.791,4,4v8.283c4.744,0.679,9.104,2.547,12.769,5.291l5.702-5.701l0.156-0.157c1.562-1.562,4.096-1.562,5.657,0s1.562,4.095,0,5.657l-0.157,0.156l-5.701,5.702c2.744,3.665,4.612,8.024,5.291,12.769H84c2.209,0,4,1.791,4,4s-1.791,4-4,4H75.717z M48,32c-8.837,0-16,7.163-16,16s7.163,16,16,16s16-7.163,16-16S56.837,32,48,32z M48,56c-4.418,0-8-3.582-8-8s3.582-8,8-8s8,3.582,8,8S52.418,56,48,56z"/></svg><b>Настройки</b></span>
		<span class="b stillsel" id="side_button" onclick="api.callWindow('side')">
		<svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M48,12C16,12,0,48.166,0,48.166S16,84,48,84s48-36,48-36S80,12,48,12z M48,76C26.854,76,13.503,56.118,9.003,48.148C13.5,40.102,26.854,20,48,20c21.15,0,34.502,19.998,38.998,28C82.494,56.016,69.145,76,48,76z M48,32c-8.836,0-16,7.164-16,16c0,8.837,7.164,16,16,16c8.837,0,16-7.163,16-16C64,39.164,56.837,32,48,32z M48,56c-4.411,0-8-3.589-8-8s3.589-8,8-8s8,3.589,8,8S52.411,56,48,56z"/><path d="M48,12C16,12,0,48.166,0,48.166S16,84,48,84s48-36,48-36S80,12,48,12z M48,76C26.854,76,13.503,56.118,9.003,48.148C13.5,40.102,26.854,20,48,20c21.15,0,34.502,19.998,38.998,28C82.494,56.016,69.145,76,48,76z M48,32c-8.836,0-16,7.164-16,16c0,8.837,7.164,16,16,16c8.837,0,16-7.163,16-16C64,39.164,56.837,32,48,32z M48,56c-4.411,0-8-3.589-8-8s3.589-8,8-8s8,3.589,8,8S52.411,56,48,56z"/></svg><b>Инструменты</b>
		</span>
		<span class="b" onclick="api.styleSwitch('night','nightMode',true,true,false);api.forceRedraw = true">
			<svg width="96px" height="96px" viewBox="0 0 96 96" class="night_hide"><path d="M40.124,16.98C40.042,17.979,40,18.986,40,20c0,19.852,16.148,36,36,36c1.014,0,2.021-0.041,3.02-0.124C75.501,69.725,62.928,80,48,80c-17.645,0-32-14.355-32-32C16,33.072,26.275,20.499,40.124,16.98 M48,8C25.909,8,8,25.909,8,48c0,22.092,17.909,40,40,40c22.092,0,40-17.908,40-40c0-0.893-0.04-1.775-0.098-2.654C84.29,47.045,80.257,48,76,48c-15.464,0-28-12.536-28-28c0-4.257,0.955-8.29,2.654-11.902C49.775,8.04,48.893,8,48,8L48,8z"/></svg><b class="night_hide">Ночь</b>
			<svg width="96px" height="96px" viewBox="0 0 96 96" class="night_nothide"><path d="M52,4v8c0,2.209-1.791,4-4,4s-4-1.791-4-4V4c0-2.209,1.791-4,4-4S52,1.791,52,4z M48,80c-2.209,0-4,1.791-4,4v8c0,2.209,1.791,4,4,4s4-1.791,4-4v-8C52,81.791,50.209,80,48,80zM14.059,14.059c-1.562,1.562-1.562,4.095,0,5.657l5.657,5.657c1.562,1.562,4.095,1.562,5.657,0c1.562-1.562,1.562-4.096,0-5.657l-5.657-5.657C18.153,12.497,15.621,12.497,14.059,14.059z M70.627,70.627c-1.562,1.562-1.562,4.096,0,5.657l5.657,5.657c1.562,1.562,4.095,1.562,5.657,0c1.562-1.562,1.562-4.095,0-5.657l-5.657-5.657C74.722,69.065,72.189,69.065,70.627,70.627z M0,48c0,2.209,1.791,4,4,4h8c2.209,0,4-1.791,4-4s-1.791-4-4-4H4C1.791,44,0,45.791,0,48z M80,48c0,2.209,1.791,4,4,4h8c2.209,0,4-1.791,4-4s-1.791-4-4-4h-8C81.791,44,80,45.791,80,48z M14.059,81.941c1.562,1.562,4.095,1.562,5.657,0l5.656-5.657c1.562-1.562,1.562-4.095,0-5.657c-1.562-1.562-4.094-1.562-5.656,0l-5.657,5.657C12.497,77.847,12.497,80.379,14.059,81.941z M70.627,25.373c1.562,1.562,4.095,1.562,5.657,0l5.657-5.657c1.562-1.562,1.562-4.095,0-5.657c-1.562-1.562-4.095-1.562-5.657,0l-5.657,5.657C69.065,21.277,69.065,23.811,70.627,25.373z M72,48c0,13.255-10.745,24-24,24S24,61.255,24,48s10.745-24,24-24S72,34.745,72,48z M64,48c0-8.837-7.163-16-16-16s-16,7.163-16,16s7.163,16,16,16S64,56.837,64,48z"/></svg><b class="night_nothide">День</b></span>
		<span class="b" onclick="api.callPopup2(windows.about)"><svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M12,28h72c2.209,0,4-1.791,4-4s-1.791-4-4-4H12c-2.209,0-4,1.791-4,4S9.791,28,12,28z M84,44H12c-2.209,0-4,1.791-4,4s1.791,4,4,4h72c2.209,0,4-1.791,4-4S86.209,44,84,44z M84,68H12c-2.209,0-4,1.791-4,4s1.791,4,4,4h72c2.209,0,4-1.791,4-4S86.209,68,84,68z"/></svg><b>Информация</b></span>
		<span class="b debug" style="float:right" id="debug_mouseInfo"></span>
	</div>
	
	<div id="bottom">
		<div class="line">
			<span class="b stillsel" onclick="api.settings.bottomHidden=false;api.styleSwitch('bottomHidden','bottomHidden',false,false,false);api.changeBottomPad(0)">Узлы</span><span class="b stillsel" onclick="api.settings.bottomHidden=false;api.styleSwitch('bottomHidden','bottomHidden',false,false,false);api.changeBottomPad(1)">Связи</span><span class="b debug" id="debug_viewport"></span>
			<span class="b" style="float:right" onclick="api.styleSwitch('bottomHidden','bottomHidden',true,true,false)">
				<span class="hide"><svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M44,12v62.344L22.828,53.172c-1.562-1.562-4.094-1.562-5.656,0c-1.562,1.562-1.562,4.095,0,5.657l28,28	c1.562,1.562,4.095,1.562,5.656,0l28-28C79.609,58.048,80,57.024,80,56c0-1.023-0.391-2.047-1.172-2.828c-1.562-1.562-4.095-1.562-5.656,0L52,74.344V12c0-2.208-1.791-4-4-4S44,9.791,44,12z"/></svg><b>Скрыть</b></span>
				<span class="nothide"><svg width="96px" height="96px" viewBox="0 0 96 96"><path d="M52,83.999V21.655l21.172,21.172c1.562,1.562,4.094,1.562,5.656,0c1.562-1.562,1.562-4.095,0-5.657l-28-28c-1.562-1.562-4.095-1.562-5.656,0l-28,28C16.391,37.951,16,38.974,16,39.999c0,1.023,0.391,2.047,1.172,2.828 c1.562,1.562,4.095,1.562,5.656,0L44,21.655v62.344c0,2.209,1.791,4,4,4S52,86.208,52,83.999z"/></svg><b>Показать</b></span>
			</span>
		</div>
		<div class="list">
			<div id="bpad1" class="pad">
				Вкладка узлов
			</div>
			<div id="bpad2" class="pad">
				Вкладка связей
			</div>
		</div>
	</div>
	
	
	<div id="windows">
		<div id="popUp" class="pu d">
			<div class="back" onclick="api.closePopup()"></div>
			<div class="w sm">
				<div class="cc" style="text-align:center">
					<div class="header" style="font-weight:700;font-size:200%;margin-bottom:20px">Загружается...</div>
					<div class="content" style="padding-bottom:16px"></div>
				</div>
				<div class="bt"><div class="table r"><div class="t3"><div class="t2">
					
				</div></div></div></div>
			</div>
		</div>
		
		<div id="settings">
			<div class="w tall">
				<div class="h">
					<span>Настройки</span>
				</div>
				<div class="close" onclick="api.closeWindow('settings')">X</div>
				<div class="cc btns" style="text-align:center">
					<div class="pad" style="display:block">
						<div class="line" style="font-weight:700;font-size:120%;margin-bottom:8px">Интерфейс</div>
						<div class="line"><label class="b i stillsel ac" style="font-weight:normal"><input type="checkbox" id="st_labels"> Подписи у иконок</label></div>
						<div class="line">Размер шрифта верхнего меню (0.8 - 1.8): <input type="text" class="b i" id="st_topfontsize" style="width:1.5em">em</div>
						<div class="line">Общий размер шрифта (50% - 200%): <input type="text" class="b i" id="st_glfontsize" style="width:2em">%</div>
						<div class="line"><label class="b i stillsel ac" style="font-weight:normal"><input type="checkbox" id="st_grid"> Отображать сетку</label></div>
						<div class="line"><label class="b i stillsel ac" style="font-weight:normal"><input type="checkbox" id="st_redGrid"> Отображать красные "нулевые" линии</label></div>
						<div class="line"><label class="b i stillsel ac" style="font-weight:normal"><input type="checkbox" id="st_debug"> Режим отладки</label></div>
					</div>
					<div class="pad" style="display:block">
						<div class="line" style="font-weight:700;font-size:120%;margin-bottom:8px">Цвета элементов</div>
						<div class="table r line"><div class="t3"><div class="t2">
							<span class="t"><span class="b fs colorMode" onclick="api.colorMode(true)">Палитра</span></span>
							<span class="t"><span class="b fs colorMode" onclick="api.colorMode(false)">#RGB</span></span>
						</div></div></div>
						<div class="table r"><div class="t3">
							<div class="t2"><span class="t de">Дестабилизирующий фактор</span><span class="t"><input class="b i fs color" type="color" style="min-width:140px"><input class="b i fs color2" type="text"></span></div>
							<div class="t2"><span class="t de">Промежуточный фактор</span><span class="t"><input class="b i fs color" type="color"><input class="b i fs color2" type="text"></span></div>
							<div class="t2"><span class="t de">Целевой фактор</span><span class="t"><input class="b i fs color" type="color"><input class="b i fs color2" type="text"></span></div>
							<div class="t2"><span class="t de">Управляющий фактор</span><span class="t"><input class="b i fs color" type="color"><input class="b i fs color2" type="text"></span></div>
							<div class="t2"><span class="t de">Негативный фактор</span><span class="t"><input class="b i fs color" type="color"><input class="b i fs color2" type="text"></span></div>
						</div></div>
					</div>
					<div class="pad debug" style="display:block">
						<div class="line red" style="font-weight:700;font-size:120%;margin-bottom:8px">Расширенные настройки</div>
						<div class="line red">Изменяйте с осторожностью!</div>
						<div class="line">Интервал обновления: <input type="text" class="b i" id="st_debugInterval" style="width:1.5em">мс</div>
						<div class="line">Размер холста: <input type="text" class="b i" id="st_debugCanvasSize" style="width:2em">%</div>
					</div>
					<div class="pad" style="display:block">
						<div class="line">
							<div class="linebar" style="height:1.5em; line-height:1.5em;" title="Максимальный размер является приблизительным, и, в зависимости от браузера, может отличаться в большую сторону."><div class="sizes" style="font-size:70%"></div></div>
						</div><div class="table r"><div class="t3"><div class="t2">
							<span class="t"><span class="b fs red" onclick="api.loadDefault();api.putSettings();api.saveSettings()">Установить умолчания</span></span>
							<span class="t"><span class="b fs red" onclick="api.callPopup2({header:'Сброс данных',content:'Внимание, абсолютно все сохраненные данные будут потеряны! Текущая сессия не будет завершена. Экспортированные данные не будут потеряны.',size:2,windowsize:'m',buttons:[{functions:'api.resetData();api.closePopup()',red:true,name:'Продолжить'},{functions:'api.closePopup()',name:'Отмена'}]})">Очистить хранилище</span></span>
						</div></div></div>
					</div>
				</div>
				<div class="bt"><div class="table r"><div class="t3"><div class="t2">
					<span class="t"><span class="b fs" onclick="api.closeWindow('settings')">Отмена</span></span>
					<span class="t"><span class="b fs" onclick="api.getSettings();api.saveSettings();api.closeWindow('settings')">Применить</span></span>
				</div></div></div></div>
			</div>
		</div>
		
		<div id="side">
			<div class="w side">
				<div class="h">
					<span>Инструменты</span>
				</div>
				<div class="close" onclick="api.closeWindow('side')">X</div>
			<div class="cc btns">
				<div class="table ps"><div class="t3"><div class="t2">
					<span class="t"><span class="b fs" onclick="api.changeSidePad(0)">Проект</span></span>
					<span class="t"><span class="b fs" onclick="api.changeSidePad(1)">Рисование</span></span>
					<span class="t"><span class="b fs" onclick="api.changeSidePad(2)">Анализ</span></span>
				</div></div></div>
				
				<div id="pad1" class="pad">
				
					<div class="line">Факторы
						<div class="table r"><div class="t3"><div class="t2">
							<span class="t"><span class="b fs" id="brush1" onclick="api.selectBrush(1)" title="Дестабилизирующий фактор">ДФ</span></span>
							<span class="t"><span class="b fs" id="brush2" onclick="api.selectBrush(2)" title="Промежуточный фактор">ПФ</span></span>
							<span class="t"><span class="b fs" id="brush3" onclick="api.selectBrush(3)" title="Целевой фактор">ЦФ</span></span>
							<span class="t"><span class="b fs" id="brush4" onclick="api.selectBrush(4)" title="Управляющий фактор">УФ</span></span>
							<span class="t"><span class="b fs" id="brush5" onclick="api.selectBrush(5)" title="Негативный фактор">НФ</span></span>
						</div></div></div>
					</div>
					
					<div class="t2 line">
						<span class="t de l">Связи</span>
						<span class="t"><div class="table r"><div class="t3"><div class="t2">
							<span class="t"><span class="b fs" id="brush0" onclick="api.selectBrush(0)">Установка</span></span>
						</div></div></div></span>
					</div>
					
					<div class="table"><span class="b line fs" id="brush-1" onclick="api.selectBrush(-1)">Просмотр</span></div>
				</div>
				
				<div id="pad2" class="pad">
					Еще не внедрено!
				</div>
				
				<div id="pad3" class="pad" style="text-align:center">
					<div class="line"><span class="b fs i" onclick="api.selectWindow(0)">Граф</span>
						<span class="b fs i" onclick="api.selectWindow(1)">Матрица достижимости</span>
						<span class="b fs i" onclick="api.selectWindow(2)">Полный эффект</span>
						<span class="b fs i" onclick="api.selectWindow(3)">Общий риск</span>
					</div>
					<div class="line">
						<span class="b fs i">Настройки проекта</span>
					</div>
				</div>
			</div>
		</div>
		
	</div>

	
	<div id="data" style="display:none">
	</div>
</body>
</html>